function f_fstab {
  echo "[$i] /etc/fstab"

  cp /etc/fstab /etc/fstab.orig

  read -r -a devices <<< "$(echo $DEVICES | sed 's/\/dev\/s/\/dev\/xv/g')"

  if [ "4" != "${#devices[@]}" ]; then
    "You cannot have more or less than four devices. Exiting."
    echo
    exit 1
  fi

  if ! lsblk | grep /var; then
    systemctl rsyslog stop

    mkfs -t ext4 ${devices[0]}
    mkdir /mnt/newvar
    mount ${devices[0]} /mnt/newvar
    cp -apx /var/* /mnt/newvar
    umount ${devices[0]}
    mv /var /var.old
    mkdir /var
    mount ${devices[0]} /var
    echo "${devices[0]}	/var	ext4	rw,relatime,data=ordered	0 0" >> /etc/fstab

    if ! lsblk | grep /var/log; then
      mkfs -t ext4 ${devices[1]}
      mkdir /mnt/newvarlog
      mount ${devices[1]} /mnt/newvarlog
      cp -apx /var/log/* /mnt/newvarlog
      umount ${devices[1]}
      mv /var/log /var/log.old
      mkdir /var/log
      mount ${devices[1]} /var/log
      echo "${devices[1]}	/var/log	ext4	rw,relatime,data=ordered  0 0" >> /etc/fstab

      if ! lsblk | grep /var/log/audit; then
        mkfs -t ext4 ${devices[2]}
        mkdir /mnt/newvarlogaudit
        mount ${devices[2]} /mnt/newvarlogaudit
        cp -apx /var/log/audit/* /mnt/newvarlogaudit
        umount ${devices[2]}
        mv /var/log/audit /var/log/audit.old
        mkdir /var/log/audit
        mount ${devices[2]} /var/log/audit
        echo "${devices[2]} /var/log/audit	ext4	rw,relatime,data=ordered	0 0" >> /etc/fstab
      fi
    fi

    systemctl start rsyslog
  fi

  if ! lsblk | grep /home; then
    mkfs -t ext4 ${devices[3]}
    mkdir /mnt/newhome
    mount ${devices[3]} /mnt/newhome
    cp -apx /home/* /mnt/newhome
    umount ${devices[3]}
    mv /home /home.old
    mkdir /home
    mount ${devices[3]} /home
    echo "${devices[3]}	/home	ext4	rw,nodev,relatime,data=ordered	0 0" >> /etc/fstab
  fi

  rm -rf /mnt/newvar
  rm -rf /mnt/newvarlog
  rm -rf /mnt/newvarlogaudit
  rm -rf /mnt/newhome

  if [ ! echo "$(mount | grep /tmp)" | grep "tmpfs on /tmp type tmpfs (rw,nosuid,nodev,noexec,relatime)" ]; then
    mount -o remount,nodev /dev/shm
    echo "tmpfs /tmp	tmpfs	rw,nosuid,nodev,noexec,relatime	0 0" >> /etc/fstab
  fi

  if [ ! echo "$(mount | grep /var/tmp)" | grep "tmpfs on /var/tmp type tmpfs (rw,nosuid,nodev,noexec,relatime)" ]; then
    mount -o remount,nodev /dev/shm
    echo "tmpfs /var/tmp	tmpfs	rw,nosuid,nodev,noexec,relatime	0 0" >> /etc/fstab
  fi

  if [ ! echo "$(mount | grep /dev/shm)" | grep "tmpfs on /dev/shm type tmpfs (rw,nosuid,nodev,noexec,relatime)" ]; then
    mount -o remount,nodev /dev/shm
    echo "tmpfs	/dev/shm	tmpfs	rw,nosuid,nodev,noexec,relatime	0 0" >> /etc/fstab
  fi

  if ! mount -a; then
    echo "You have a problem with your /etc/fstab file. Try again."
    echo
    exit 1
  fi

  rm /etc/fstab.orig

  ((i++))
}
